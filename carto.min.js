(function(){var a={map:!1,actualMap:!1,el:!1,provider:!1,type:!1,sensor:!1,geocoder:!1,center:!1,markers:[],polylines:[],directions:[],mapTypes:[],animations:[],realignedPolylines:[],init:function(a){this.provider=a.provider||!1,this.type=a.type||!1,this.el=a.element||!1,this.center=a.center||!1,this.zoom=a.zoom||8,this.markers=a.markers||[],this.polylines=a.polylines||[];switch(this.provider){case"gmap":var b=document.createElement("script");b.type="text/javascript",b.src="http://maps.googleapis.com/maps/api/js?sensor=false&callback=Carto.setupMap",document.body.appendChild(b);var c=this;break;case"ovi":case"bing":alert("not supported");break;default:this.detectMap(),this.getMapObj(),this.setupMap()}},setupMap:function(){this.getMapObj();if(typeof this.center=="string"){var a=this;switch(this.provider){case"gmap":this.animations=google.maps.Animation,this.mapTypes=google.maps.MapTypeId,this.geocoder.geocode({address:this.center},function(b,c){a.center=b[0].geometry.location,a.actualMap=a.draw();if(a.actualMap)return a.pushMarkers(a.markers,a.actualMap),a.pushPolylines(a.polylines,a.actualMap),a});break;case"bing":case"ovi":alert("Support not implemented")}}},pushPolylines:function(a,b){var c=a.length;for(var d=0;d<c;d++){var e=a[d];if(typeof e=="object"){var f=[];for(j=0;j<e.waypoints.length;j++){var g=e.waypoints[j],h={totalPointers:e.waypoints.length,originalWaypoints:e.waypoints,polyline:e,builder:f,currentMarker:j};if(typeof g=="object"){var i=new google.maps.LatLng(g.lat,g.long);h.builder.push(i);if(h.totalPointers===h.builder.length){var k=new google.maps.Polyline({path:h.builder,strokeColor:h.polyline.colour,strokeOpacity:h.polyline.opacity,strokeWeight:h.polyline.weight});k.setMap(b)}}else this.geocodeAddr(e.waypoints[j],function(a,c,d){d.realignedPolylines=[],c.builder.push({location:a,address:c.originalWaypoints[c.currentMarker]});if(c.totalPointers===c.builder.length){for(var e=0;e<c.totalPointers;e++)for(var f=0;f<c.totalPointers;f++)c.originalWaypoints[e]===c.builder[f].address?(d.realignedPolylines[e]=c.builder[f].location,e!==f):c.builder[f].address==undefined&&(d.realignedPolylines[e]=c.builder[f]);var g=new google.maps.Polyline({path:d.realignedPolylines,strokeColor:c.polyline.colour,strokeOpacity:c.polyline.opacity,strokeWeight:c.polyline.weight});g.setMap(b);return}},h,this)}}}},pushMarkers:function(a,b){var c=a.length;for(var d=0;d<c;d++)if(typeof a[d]=="object")if(a[d].location){var e=this;this.geocodeAddr(a[d].location,function(a,c,d){var e=new google.maps.Marker({position:a,map:b,icon:c.image||"",title:c.name}),f=new google.maps.InfoWindow({content:c.iwindow.content||'<div id="content"><div id="siteNotice"></div><h1 id="firstHeading" class="firstHeading">'+c.name+"</h1></div>"});google.maps.event.addListener(e,"click",function(){f.open(b,e)}),d.markers.push(e)},a[d],this)}else{var f=new google.maps.Marker({position:new google.maps.LatLng(a[d].lat,a[d].long),map:b,title:a[d].name,icon:a[d].image||""}),g=new google.maps.InfoWindow({content:a[d].iwindow.content});google.maps.event.addListener(f,"click",function(){g.open(b,f)}),this.markers.push(f)}else{var e=this;this.geocodeAddr(a[d],function(a,c,d){var e=new google.maps.Marker({position:a,map:b,title:c}),f=new google.maps.InfoWindow({content:'<div id="content"><div id="siteNotice"></div><h1 id="firstHeading" class="firstHeading">'+c+"</h1></div>"});google.maps.event.addListener(e,"click",function(){f.open(b,e)}),d.markers.push(e)},a[d],this)}},geocodeAddr:function(a,b,c,d){this.geocoder.geocode({address:a},function(a,e){e==="OK"&&b(a[0].geometry.location,c,d)})},authenticate:function(){},mapFunctions:function(){},detectMap:function(){this.type=window.google?"gmap":window.Microsoft?"bing":window.ovi?"ovi":!1;if(this.type===!1)return this.callError("unsupported"),!1},getMapObj:function(){switch(this.provider){case"gmap":this.geocoder=new google.maps.Geocoder,this.map=window.google.maps;break;case"bing":return window.Microsoft.Maps;case"ovi":return window.ovi.mapsapi}return!1},reverseGeocode:function(){},draw:function(){switch(this.provider){case"gmap":var a={zoom:this.zoom,center:this.center,mapTypeId:google.maps.MapTypeId.ROADMAP};return new google.maps.Map(document.getElementById(this.el.replace("#","")),a);case"bing":case"ovi":return alert("Support not yet implemented"),!1}},callError:function(a){console?console.log(a):alert(a)}};window.Carto||(window.Carto=a)})();